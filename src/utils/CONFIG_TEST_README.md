# Config.cfg 测试用例说明

## 概述

为调整后的 `config.cfg` 文件提供了完整的测试套件，确保 ACTIVE_DATASET 机制、自动配置填充和 API 兼容性等功能的正确性。

## 测试用例文件

### 1. 全面测试用例 - `test_config_cfg.py`

最完整的测试套件，包含所有功能的详细测试：

```bash
cd src/utils
python test_config_cfg.py
```

**测试内容:**
- ✅ 基本配置文件结构验证
- ✅ 数据集配置段完整性检查
- ✅ ACTIVE_DATASET 机制测试
- ✅ 数据集切换功能验证
- ✅ API 兼容性测试
- ✅ 边缘情况处理测试
- ✅ 配置完整性验证

**输出示例:**
```
============================================================
开始 config.cfg 调整后的全面测试
============================================================
✓ PASS: 基本配置结构
✓ PASS: 数据集配置段
✓ PASS: ACTIVE_DATASET机制
✓ PASS: 数据集切换功能
✓ PASS: API兼容性
✓ PASS: 边缘情况测试
✓ PASS: 配置完整性

============================================================
测试总结
============================================================
总测试数: 7
通过测试: 7
失败测试: 0
通过率: 100.0%

🎉 所有测试通过！config.cfg 调整成功！
```

### 2. 快速测试用例 - `quick_test_config.py`

日常使用的快速验证工具：

```bash
cd src/utils
python quick_test_config.py
```

**测试内容:**
- 基本配置读取验证
- 数据集切换功能检查
- 关键配置填充验证
- 可用数据集列表显示

**输出示例:**
```
🔍 config.cfg 快速测试
----------------------------------------
1. 测试基本配置读取...
   ✓ 数据集路径: ./dataset/CIC-IDS-2017
   ✓ 会话模式: srcIP_dstIP_dstPort_proto

2. 测试数据集切换功能...
   ✓ 当前数据集: CIC-IDS-2017

3. 验证关键配置...
   ✓ 所有关键配置都已正确填充

4. 可用数据集:
   👉 CIC-IDS-2017
     CIC-AndMal2017
     USTC-TFC2016
     CIC-IoT-2023
     CTU-13

✅ config.cfg 测试通过！配置调整成功！

💡 使用提示:
   切换数据集: 编辑 config.cfg 中的 ACTIVE_DATASET 参数
   例如: ACTIVE_DATASET = USTC-TFC2016
   重启程序后生效
```

### 3. 调试工具 - `debug_api_consistency.py`

用于调试API一致性问题的专用工具：

```bash
cd src/utils
python debug_api_consistency.py
```

**功能:**
- 对比传统ConfigParser和新API的结果
- 诊断配置自动填充是否正常工作
- 帮助识别配置问题

## 测试覆盖范围

### 核心功能测试

1. **ACTIVE_DATASET 机制**
   - 验证 ACTIVE_DATASET 参数正确读取
   - 测试自动配置填充功能
   - 确保PATH和SESSION段正确填充

2. **数据集配置验证**
   - 5个预定义数据集配置完整性
   - 必要参数存在性检查
   - 配置格式正确性验证

3. **数据集切换测试**
   - 动态切换不同数据集
   - 配置自动更新验证
   - 多数据集循环测试

### 兼容性测试

4. **API 兼容性**
   - 传统ConfigParser方式兼容
   - 新API函数正常工作
   - 配置结果一致性验证

5. **边缘情况处理**
   - 无效数据集名称处理
   - 配置缓存刷新机制
   - 异常情况容错能力

6. **配置完整性**
   - 所有必要配置段存在
   - 关键配置参数完整
   - 数据集特定配置正确

## 使用建议

### 日常使用

- **快速检查**: 使用 `quick_test_config.py` 进行日常验证
- **修改配置后**: 运行快速测试确保配置正确
- **切换数据集后**: 验证新数据集配置是否生效

### 开发调试

- **详细测试**: 使用 `test_config_cfg.py` 进行完整测试
- **问题诊断**: 使用 `debug_api_consistency.py` 定位问题
- **功能扩展**: 在现有测试基础上添加新的测试用例

### 持续集成

可以将测试集成到CI/CD流程中：

```bash
# 在构建脚本中添加
cd src/utils
python test_config_cfg.py
if [ $? -ne 0 ]; then
    echo "配置测试失败，终止构建"
    exit 1
fi
```

## 故障排除

### 常见问题

1. **测试失败: 配置段缺失**
   - 检查 config.cfg 文件完整性
   - 确保所有必要section存在

2. **数据集切换不生效**
   - 验证 ACTIVE_DATASET 拼写正确
   - 检查目标数据集配置段存在

3. **API不一致**
   - 运行 `debug_api_consistency.py` 诊断
   - 检查配置自动填充是否正常

### 解决方案

1. **恢复配置**: 测试会自动备份和恢复配置
2. **刷新缓存**: 使用 `refresh_config()` 强制刷新
3. **重置配置**: 从备份恢复原始配置

## 扩展测试

如需添加新的数据集或配置项，可以：

1. 在测试用例中添加相应的验证逻辑
2. 扩展 `test_dataset_sections()` 方法
3. 更新边缘情况测试覆盖新的配置项

这样可以确保配置文件的任何修改都经过充分的测试验证。